networks:
  sentinelwatch:
    driver: bridge
services:
  backend:
    build:
      context: .
      dockerfile: backend/Dockerfile
    container_name: sentinelwatch-backend
    environment:
    - DATABASE_URL=sqlite:////app/backend/data/db.sqlite3
    - PYTHONUNBUFFERED=1
    - ANTHROPIC_API_KEY=${ANTHROPIC_API_KEY}
    healthcheck:
      interval: 30s
      retries: 3
      start_period: 5s
      test:
      - CMD
      - curl
      - -f
      - http://localhost:8000/health
      timeout: 10s
    networks:
    - sentinelwatch
    ports:
    - 8000:8000
    restart: unless-stopped
    volumes:
    - ./backend/data:/app/backend/data
  frontend:
    build:
      args:
        VITE_API_BASE_URL: /api
      context: .
      dockerfile: frontend/Dockerfile
    container_name: sentinelwatch-frontend
    depends_on:
      backend:
        condition: service_healthy
    environment:
    - VITE_API_BASE_URL=/api
    healthcheck:
      interval: 30s
      retries: 3
      start_period: 10s
      test:
      - CMD
      - wget
      - --quiet
      - --tries=1
      - --spider
      - http://localhost:3000
      timeout: 10s
    networks:
    - sentinelwatch
    ports:
    - 3165:3000
    restart: unless-stopped
version: '3.9'
volumes:
  backend_data:
    driver: local
